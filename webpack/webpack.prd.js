const path = require('path');

const MiniCssExtractPlugin = require('mini-css-extract-plugin');

const OptimizeCssAssetsPlugin = require('optimize-css-assets-webpack-plugin');

const UglifyJsPlugin = require('uglifyjs-webpack-plugin');

const merge = require('webpack-merge');

const common = require('./webpack.common.js');



let prodConfig = {

  mode: 'production',

  output: {

    filename: 'main.[hash].js',

    path: path.resolve(__dirname, '../dist')

  },

  module: {

    rules: [{

      test: /\.(sc|c|sa)ss$/,

      use: [

        MiniCssExtractPlugin.loader, {

          loader: "css-loader",

          options: { sourceMap: true }

        }, {

          loader: "postcss-loader",

          options: {

            ident: "postcss", sourceMap: true,

            plugins: loader => [require('autoprefixer')()]

          }

        }, {

          loader: "sass-loader",

          options: { sourceMap: true }

        }

      ]

    }]

  },

  plugins: [

    new MiniCssExtractPlugin({

      filename: '[name].[hash].css',

      chunkFilename: '[id].[hash].css'

    }),

    new OptimizeCssAssetsPlugin({}),

    new UglifyJsPlugin({

      cache: true, parallel: true, sourceMap: true

    }),

  ],

}

module.exports = merge(common, prodConfig)